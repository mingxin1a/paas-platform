# ERP 细胞 - 用户手册

**版本**：1.2.0 | **细胞**：企业资源计划（ERP）

## 1. 概述

本细胞提供财务总账（GL）、应收（AR）、应付（AP）、物料（MM）、生产计划（PP）及订单能力，经 PaaS 网关 `/api/v1/erp` 暴露。支持分页、软删除、统一错误体、必填与业务规则校验、审计日志与收付款幂等。

## 2. 功能入口（API）

| 能力 | 方法 | 路径示例 |
|------|------|----------|
| 健康检查 | GET | /health |
| 订单 | GET/POST/DELETE | /orders（列表支持 page, pageSize） |
| 总账科目 | GET/POST/DELETE | /gl/accounts（列表分页） |
| 分录 | GET/POST | /gl/journal-entries（dateFrom/dateTo、page、pageSize） |
| 科目余额/试算表 | GET | /gl/balance, /gl/trial-balance |
| 应收发票 | GET/POST/DELETE | /ar/invoices（列表分页） |
| 收款登记 | POST | /ar/invoices/{id}/receipts（幂等：X-Request-ID） |
| 应收账龄 | GET | /ar/ageing |
| 应付发票 | GET/POST/DELETE | /ap/invoices（列表分页） |
| 付款登记 | POST | /ap/invoices/{id}/payments（幂等：X-Request-ID） |
| 应付账龄 | GET | /ap/ageing |
| 物料 | GET/POST/DELETE | /mm/materials（列表分页） |
| 采购订单 | GET/POST/DELETE | /mm/purchase-orders（列表分页） |
| BOM | GET/POST/DELETE | /pp/boms（列表分页） |
| 工单 | GET/POST/DELETE | /pp/work-orders（列表分页） |
| 工单报工 | POST | /pp/work-orders/{id}/report |

- 金额单位：分（Long）。创建类 POST 需 `X-Request-ID`、`X-Tenant-Id`。
- 列表接口：查询参数 `page`（默认 1）、`pageSize`（默认 20，最大 100），响应含 `data`、`total`、`page`、`pageSize`。
- DELETE 为软删除，资源仍保留于存储，查询与列表不再返回已删除数据。

## 3. 错误响应

统一格式：`{ "code": "...", "message": "...", "details": "...", "requestId": "..." }`。常见 code：`NOT_FOUND`（404）、`IDEMPOTENT_CONFLICT`（409）、`VALIDATION_ERROR`（必填/格式）、`BUSINESS_RULE_VIOLATION`（如借贷不平衡、收款超待收金额）。

## 4. 典型流程

- **总账**：创建科目 → 录入分录（**借贷必须平衡**）→ 查询试算表/余额。
- **应收**：开票 → 登记收款（金额 ≤ 待收，可幂等）→ 查看账龄。
- **工单**：创建 BOM 与工单 → 报完工数量（/report）。

## 5. 约束

- 独立 Schema，禁止跨细胞库直连。遵循《01_核心法律》与《数据库设计说明书》。
