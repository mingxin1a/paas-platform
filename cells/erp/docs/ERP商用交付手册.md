# ERP 商用交付手册

**版本**：1.0（商用可交付） | **细胞**：企业资源计划（ERP）

## 1. 交付范围

本手册适用于 ERP 细胞按「商用可交付」标准的交付验收与运维说明。ERP 细胞与 CRM/OA/SRM 严格解耦，独立数据库、独立部署，仅通过 PaaS 层标准化接口对外服务。

### 1.1 功能闭环（当前与规划）

| 模块 | 能力 | 当前状态 | 商用规划 |
|------|------|----------|----------|
| 基础数据 | 物料、客户、供应商、仓库 | 物料/订单/客户/供应商通过 MM、订单、AR/AP 体现 | 可扩展独立主数据接口 |
| 采购 | 申请→订单→入库→应付 | 采购订单（MM）已实现；应付（AP）已实现 | 采购申请、入库单、与 AP 关联 |
| 销售 | 报价→订单→出库→应收 | 销售订单、应收（AR）已实现 | 报价单、出库单、与 AR 关联 |
| 库存 | 调拨、盘点、预警 | 物料主数据已实现 | 库存表、调拨、盘点、安全库存预警 |
| 财务 | 应收/应付/费用/报表 | GL、AR、AP 已实现；余额与报表已实现 | 费用模块、简单报表增强 |

### 1.2 已实现能力

- **订单**：销售订单 CRUD、软删除、幂等创建、分页。
- **总账 GL**：科目、分录、过账、余额查询、审计。
- **应收 AR**：应收发票 CRUD、软删除、幂等创建。
- **应付 AP**：应付发票 CRUD、软删除、幂等创建。
- **物料 MM**：物料 CRUD、软删除、幂等创建。
- **采购 MM**：采购订单 CRUD、软删除、幂等创建。
- **生产 PP**：BOM、工单 CRUD、软删除、幂等创建。
- **统一规范**：X-Tenant-Id、X-Request-ID、错误体 code/message/details/requestId、人性化审计、验签可选。

### 1.3 约束与依赖

- **解耦**：独立存储（当前内存存储，可切换 SQLite/MySQL），仅通过网关暴露接口。
- **接口**：遵循《接口设计说明书》；金额单位：分；所有 POST 写操作幂等（X-Request-ID）。
- **监控**：/health；商用级可扩展 /metrics（采购订单量、库存周转率、应收账龄等）与 PaaS 监控打通。
- **数据安全**：财务数据加密存储（生产建议）；库存数据权限（仓库管理员仅本仓库）为规划项。
- **可靠性**：采购入库/销售出库接口幂等性、库存防超卖为后续闭环实现；异常提示已商用化（如「订单不存在」）。

## 2. 部署与配置

### 2.1 环境变量

| 变量 | 说明 | 默认 |
|------|------|------|
| PORT | 服务端口 | 8002 |
| CELL_VERIFY_SIGNATURE | 是否开启网关验签 | 0 |

### 2.2 Docker 部署

```bash
cd paas-platform/cells/erp
docker build -t erp-cell:latest .
docker run -p 8002:8002 erp-cell:latest
```

### 2.3 数据备份（商用级）

- **每日全量 + 实时增量**：当前为内存存储，商用落地需切换持久化库后，通过数据库备份脚本（如 mysqldump + binlog）实现；脚本需由运维在部署文档中配置。

## 3. 验收要点

- 订单/AR/AP/物料/采购订单/BOM/工单 创建时带相同 X-Request-ID 返回 409 或原资源。
- 错误响应为 JSON：code、message、details、requestId。
- /health 返回 `{"status":"up","cell":"erp"}`。
- 所有写操作有人性化审计日志（谁在何时对何资源做了何操作）。

## 4. 交付物清单

- 本手册（ERP商用交付手册.md）
- 《ERP管理员手册》
- 《ERP用户操作指南》
- 《ERP测试报告（商用级）》
- Dockerfile、docker-compose.yml
- api_contract.yaml（OpenAPI）
