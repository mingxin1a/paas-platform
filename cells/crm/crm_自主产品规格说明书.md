# CRM 自主产品规格说明书

**角色**：首席产品官（CPO）+ 首席架构师（CA）  
**依据**：业界最佳实践（Salesforce、HubSpot、Microsoft Dynamics 等）推导，不依赖既有需求列表。  
**原则**：功能定义开放探索，架构实现封闭（仅 PaaS 网关 + 独立 Schema + @superpaas/ui-components）。

---

## 1. 产品愿景与边界

CRM 细胞为企业提供**可付费的客户关系管理能力**：从获客、培育、商机到成单与客户成功，全流程可追溯、可度量、可协作。所有能力经 PaaS 标准网关暴露，前端仅使用平台标准组件库，无外部依赖。

---

## 2. 功能全景（自主推导）

### 2.1 线索（Leads）

| 功能项 | 描述 | 状态 |
|--------|------|------|
| 线索创建 | 支持姓名、公司、电话、邮箱、来源 | 已实现 |
| 线索分配 | 分配给销售或队列 | 已实现 |
| 线索转化 | 转化为客户和/或商机（account/opportunity/both） | 已实现 |
| 线索列表/筛选 | 按状态、负责人、来源分页查询 | 已实现 |
| 线索评分 | 基于规则或模型的线索打分，优先跟进 | 规划 |
| 线索去重 | 同一公司/邮箱/电话合并提醒 | 规划 |
| 批量分配/导入 | 批量分配负责人、CSV 导入 | 规划 |

### 2.2 客户（Accounts）与联系人（Contacts）

| 功能项 | 描述 | 状态 |
|--------|------|------|
| 客户 CRUD | 创建、查询、列表、分页 | 已实现 |
| 联系人 CRUD | 关联客户，主联系人标记 | 已实现 |
| 客户 360° 视图 | 聚合客户档案、联系人、商机、关系 | 已实现 |
| 客户关系图谱 | 父子/伙伴关系 nodes+edges | 已实现 |
| 客户合并 | 重复客户合并为单一主记录 | 规划 |
| 客户层级 | 集团-子公司-部门层级 | 规划 |
| 联系人角色 | 决策者/影响者/使用者等角色标签 | 规划 |

### 2.3 商机（Opportunities）

| 功能项 | 描述 | 状态 |
|--------|------|------|
| 商机 CRUD | 创建、列表、按客户筛选 | 已实现 |
| 阶段与赢率 | 阶段状态机、阶段赢率配置 | 已实现 |
| 预测金额 | 按阶段汇总、加权预测 | 已实现 |
| 赢率分析 | 周期内赢单/输单占比 | 已实现 |
| 商机行项目 | 产品+数量+单价，金额由行项目汇总 | 本期实现 |
| 商机审批 | 大额/折扣审批流（提交、通过、拒绝） | 本期实现 |
| 竞品与输单原因 | 输单时记录竞品、原因 | 规划 |
| 商机拆分 | 按产品/区域拆分子商机 | 规划 |

### 2.4 活动与任务（Activities & Tasks）

| 功能项 | 描述 | 状态 |
|--------|------|------|
| 活动创建 | 关联线索/商机/客户，类型：电话/会议/待办/邮件 | 本期实现 |
| 活动列表 | 按关联对象、类型、时间范围查询 | 本期实现 |
| 活动完成/延期 | 状态更新、完成时间 | 本期实现 |
| 日历视图数据 | 按日/周返回活动列表供日历展示 | 本期实现 |
| 跟进提醒 | 到期未完成活动提醒（API 返回待办列表） | 本期实现 |

### 2.5 产品与价格（Products & Pricing）

| 功能项 | 描述 | 状态 |
|--------|------|------|
| 产品目录 | 产品编码、名称、单位、标准价（分） | 本期实现 |
| 商机行项目 | 商机下挂产品、数量、单价、小计 | 本期实现 |
| 价格表 | 多价格表（标准/促销），按客户或渠道 | 规划 |
| 折扣规则 | 数量阶梯、审批后折扣 | 规划 |

### 2.6 管道与报表（Pipeline & Reports）

| 功能项 | 描述 | 状态 |
|--------|------|------|
| 管道汇总 | 按阶段统计商机数量、金额、加权金额 | 本期实现 |
| 赢率报表 | 周期赢率、按阶段/负责人维度 | 已实现 |
| 活动统计 | 按负责人/类型统计活动数 | 本期实现 |
| 销售漏斗图数据 | 各阶段漏斗数据 API | 本期实现 |
| 自定义报表 | 用户自定义维度与指标（保存、订阅） | 规划 |

### 2.7 审批与协作（Approval & Collaboration）

| 功能项 | 描述 | 状态 |
|--------|------|------|
| 审批请求 | 提交折扣/大额商机审批，关联商机 | 本期实现 |
| 审批处理 | 通过/拒绝，记录审批人与意见 | 本期实现 |
| 审批列表 | 待我审批、我已审批 | 本期实现 |
| 移动端审批 | 同一 API，前端适配移动（@superpaas/ui-components） | 本期实现（API 就绪） |
| 多级审批 | 多级审批链、转审 | 规划 |

### 2.8 沟通与触达（Communication）

| 功能项 | 描述 | 状态 |
|--------|------|------|
| 邮件/文档模板合并 | 模板占位符替换（如 {{客户名}}），输出合并后文本 | 本期实现 |
| 邮件发送 | 经平台统一邮件服务（若平台提供） | 规划 |
| 短信/站内信 | 经平台通道 | 规划 |

### 2.9 智能与自动化（AI & Automation）

| 功能项 | 描述 | 状态 |
|--------|------|------|
| AI 销售预测 | 基于历史赢率与管道的预测（启发式/规则，无外网） | 规划 |
| 下一步最佳行动 | 推荐联系谁、做什么活动 | 规划 |
| 商机健康度 | 基于活动频率、阶段停留时长等评分 | 规划 |
| 工作流自动化 | 阶段变更自动创建任务、发送通知 | 规划 |

### 2.10 管理与配置（Admin）

| 功能项 | 描述 | 状态 |
|--------|------|------|
| 阶段配置 | 商机阶段名称、赢率、排序 | 规划（当前内置） |
| 字段级权限 | 敏感字段脱敏、可见性 | 规划 |
| 数据导入/导出 | 批量导入、导出（审计合规） | 规划 |

---

## 3. 本期实现范围（封闭架构交付）

以下功能在本轮**全自动实现、测试、交付**：

1. **活动/任务**：创建、列表、完成、按对象/类型/时间查询；日历数据 API；待办提醒列表。  
2. **产品目录 + 商机行项目**：产品 CRUD；商机行项目增删改查；商机总金额由行项目汇总。  
3. **管道报表**：管道汇总 API（按阶段数量、金额、加权）；销售漏斗数据 API。  
4. **审批**：审批请求提交、通过/拒绝、待审批/已审批列表。  
5. **模板合并**：POST 模板内容 + 上下文键值，返回合并后文本（占位符 {{key}} 替换）。

实现约束：后端仅通过 platform_core/core/gateway（PaaS 网关）暴露；数据独立 Schema；前端仅使用 @superpaas/ui-components（本周期交付 API，前端可后续接入）。

---

## 4. 验收标准

- 每个新功能具备验收测试（tests/acceptance/）。  
- delivery.package 与 completion.manifest 更新。  
- `./run.sh verify crm` 或 `./scripts/verify_delivery.sh crm` 通过。  
- 无新增外部库或非标准接口。

---

## 5. 版本与后续

- 当前说明书对应 **CRM v1.2.0**（本期实现完成后）。  
- 规划项在后续迭代中按优先级纳入，始终遵循「开放功能探索、封闭架构实现」。
