# SRM 商用交付手册

**版本**：1.0（商用可交付） | **细胞**：供应商关系管理（SRM）

## 1. 交付范围

本手册适用于 SRM 细胞按「商用可交付」标准的交付验收与运维说明。SRM 与 CRM/ERP/OA 严格解耦，独立数据库、独立部署，仅通过 PaaS 层标准化接口对外服务。

### 1.1 功能闭环

| 能力 | 说明 | 状态 |
|------|------|------|
| 供应商准入 | 供应商创建、准入审核（Schema 已定义） | 供应商 CRUD 已实现；准入审核可扩展 |
| 供应商评估 | 评估记录、按供应商查询 | 已实现 |
| 采购需求 | Schema 已定义，数据权限（采购专员仅看自己负责的供应商） | 可扩展接口 |
| 询报价 | RFQ 创建、报价提交（幂等） | 已实现 |
| 采购订单 | 采购订单 CRUD | 已实现 |
| 供应商对账 | Schema 已定义 | 可扩展接口 |
| 供应商评级 | Schema 已定义 | 可扩展接口 |
| 数据安全 | 供应商报价加密存储（生产建议） | 存储层可扩展加密 |
| 可靠性 | 询报价提交幂等、准入审核异常提示商用化 | 已实现 |
| 可运维 | /health；可扩展 /metrics（准入效率、报价对比率）、供应商数据备份脚本 | 健康检查已实现 |

### 1.2 约束与依赖

- **解耦**：独立存储（当前内存），独立部署；仅经网关暴露接口。
- **接口**：遵循《接口设计说明书》；POST 写操作幂等（X-Request-ID）；异常提示商用化（如「供应商不存在，请先完成供应商准入」）。
- **监控**：可与 PaaS 监控打通；供应商数据备份脚本在持久化落地后由运维配置。

## 2. 部署与配置

### 2.1 环境变量

| 变量 | 说明 | 默认 |
|------|------|------|
| PORT | 服务端口 | 8008 |
| CELL_VERIFY_SIGNATURE | 是否开启网关验签 | 0 |

### 2.2 Docker 部署

```bash
cd paas-platform/cells/srm
docker build -t srm-cell:latest .
docker run -p 8008:8008 srm-cell:latest
```

### 2.3 健康检查

- `GET /health` 返回 `{"status":"up","cell":"srm"}`。

## 3. 验收要点

- 询价单创建：POST /rfqs，带 X-Request-ID 幂等。
- 报价提交：POST /quotes，body 含 rfqId、supplierId、amountCents；询价单不存在时返回「询价单不存在」等商用提示。
- 供应商评估：POST /evaluations，供应商不存在时返回「供应商不存在，请先完成供应商准入」。
- 同一 X-Request-ID 重复提交报价/评估返回 409 幂等冲突。

## 4. 交付物清单

- 本手册（SRM商用交付手册.md）
- 《SRM供应商管理指南》
- 《SRM接口文档》
- Dockerfile、docker-compose.yml
- database_schema.sql（含准入、评估、需求、询报价、对账、评级表）
