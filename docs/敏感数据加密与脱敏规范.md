# 敏感数据加密与脱敏规范

**依据**：《01_核心法律》2.2 加密存储、《00_最高宪法》修正案 #4 数据主权。  
**适用范围**：所有细胞的 Schema、应用层存储、界面与日志输出。

---

## 1. 存储层加密

### 1.1 适用字段

- 手机号（contact_phone、phone、mobile 等）
- 身份证号（id_card、id_number 等）
- 电子邮箱（contact_email、email，若与身份强关联）
- 住址（address，完整门牌）
- 患者/用户姓名（在医疗、金融等场景下）
- 其他可单独或组合识别个人的字段

### 1.2 算法与密钥

- **算法**：AES-256-GCM 或国密 SM4，二选一或按行业要求。
- **密钥管理**：密钥不得硬编码；须由 KMS（如云厂商 KMS、HashiCorp Vault）注入或轮换，应用通过环境变量或运行时 API 获取。
- **存储形态**：敏感列以密文存储；可为 BLOB 或定长密文列（IV + ciphertext，按算法规范）。

### 1.3 Schema 约定

- 在表/列注释中注明「加密：AES-256 或 SM4，密钥由 KMS 管理」。
- 示例：`contact_phone_encrypted BLOB COMMENT '加密：AES-256，KMS 密钥'`；或保留 contact_phone 列名但注释中写明实施时须替换为加密存储。

---

## 2. 界面与日志：动态脱敏

- **严禁**：在任何环节（内存、日志、界面、导出）以**明文完整**展示手机号、身份证、住址等。
- **必须**：动态脱敏策略，例如：
  - 手机号：138****5678
  - 身份证：110***********1234
  - 邮箱：a***@example.com
- **实现**：界面渲染与日志输出前经脱敏服务或统一掩码函数处理；审计日志中可保留密文引用或哈希，不落盘明文。

---

## 3. 与细胞 Schema 的对应

- 各细胞 `database_schema.sql` 中已标注敏感列或脱敏配置的，**实施时**须按本规范落实加密与脱敏。
- CRM：contact_phone、contact_email 等 → 见本规范 1.1、1.2。
- HIS：name_encrypted 等 → 算法 AES-256 或国密 SM4，密钥由 KMS 管理；展示侧动态脱敏。

---

**文档状态**：与 00/01 一致，实施时必遵。
