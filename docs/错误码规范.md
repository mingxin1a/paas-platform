# 全平台错误码规范

**用途**：统一 API 错误响应格式，便于前端与 Postman 对接；与 OpenAPI 一致。

---

## 1. 响应格式

```json
{
  "code": "ERROR_CODE",
  "message": "简短说明",
  "details": "可选详情",
  "requestId": "X-Request-ID 或 traceId"
}
```

HTTP 状态码与 code 对应关系见下表。

---

## 2. 错误码表（网关与通用）

| HTTP | code | message 说明 |
|------|------|----------------|
| 400 | BAD_REQUEST | 请求参数错误 |
| 400 | MISSING_HEADER | 缺少必须请求头（Content-Type/Authorization/X-Request-ID） |
| 400 | MISSING_TENANT_ID | 缺少租户标识 X-Tenant-Id |
| 401 | UNAUTHORIZED | 未登录或 token 无效 |
| 401 | INVALID_APP_KEY | 应用密钥 X-App-Key 无效 |
| 403 | SIGNATURE_INVALID | 验签失败 |
| 404 | NOT_FOUND | 资源不存在 |
| 429 | RATE_LIMIT | 请求过于频繁，限流 |
| 502 | CELL_UNREACHABLE | 细胞不可达 |
| 502 | UPSTREAM_ERROR | 上游服务错误 |
| 503 | SERVICE_UNAVAILABLE | 服务不可用 |
| 503 | CELL_NOT_FOUND | 细胞未注册 |
| 503 | CIRCUIT_OPEN | 细胞熔断中 |
| 503 | RED_LIGHT | 系统负载过高，仅允许只读 |

---

## 3. 业务错误码（细胞）

细胞可在 4xx 响应中返回自有 code，建议前缀细胞名或模块，如：

- CRM：CUSTOMER_NOT_FOUND、DUPLICATE_PHONE
- ERP：INSUFFICIENT_STOCK、INVALID_AMOUNT
- 通用：BUSINESS_RULE_VIOLATION、IDEMPOTENT_CONFLICT

详见各细胞接口文档及 `docs/api/错误码表.md`。
