# 配置项与扩展点

与《详细设计说明书》及《详细设计实现说明》配套，便于运维与二次开发。

> **说明**：下文部分内容针对 Java 合规实现（platform-gateway / cell-*）；本仓库 **pass-platform** 当前以 **Python 网关**（platform_core）与 **Python 细胞**（cells/*）为主，**端口与路由规范、请求头约定、扩展点思路**仍适用。本仓库网关默认端口 8000，细胞端口见 deploy 与《架构实现对照表》中「本仓库当前实现」一节。

---

## 1. 平台网关（platform-gateway / 本仓库：platform_core）

| 配置项 | 说明 | 默认/示例 |
|--------|------|-----------|
| server.port / GATEWAY_PORT | 监听端口 | Java 8080；本仓库 8000 |
| GATEWAY_ROUTES_PATH | 路由文件路径（可选） | 指向 JSON 或 YAML；YAML 支持 gateway_route_spec 格式（routes 数组 id/path_prefix/upstream）；未设时以环境变量 CELL_*_URL 为主 |
| spring.cloud.gateway.routes / 路由表 | 路由表 | 见 application.yml 或 gateway_route_spec.yaml；Docker 下用服务名 uri |
| api.version | 响应头 X-API-Version 的值 | 1.0.0 |
| api.rate-limit.enabled | 是否启用按 IP 限流 | true |
| api.rate-limit.max-per-minute | 每 IP 每分钟最大请求数，超出返回 429 | 120 |
| SPRING_PROFILES_ACTIVE | 激活 profile（Java） | 本地不设；Docker 设为 docker |

**扩展点**：新增路由在路由表增加一项；鉴权可加 GlobalFilter 或中间件。限流为内存单机实现，多实例可接 Redis 或配置中心。

---

## 2. 认证服务（platform-auth）

| 配置项 | 说明 | 默认/示例 |
|--------|------|-----------|
| server.port | 监听端口 | 8081 |

**扩展点**：JWT 密钥、多租户数据源、验签密钥等；当前为占位，后续按 01 核心法律 4.2 接入。

---

## 3. 用户细胞（cell-user）

| 配置项 | 说明 | 默认/示例 |
|--------|------|-----------|
| server.port | 监听端口 | 8082 |
| spring.profiles.active | 持久化方式 | 默认内存；jpa 使用 H2 |
| spring.datasource.url（jpa） | 数据源 | jdbc:h2:mem:cell_user |
| spring.jpa.hibernate.ddl-auto（jpa） | 建表策略 | create-drop（开发）；生产建议 validate 或 none |

**扩展点**：EventPublisher 实现可替换为 Kafka；UserRepository 可增加其他实现（如 Redis 缓存层）。

---

## 4. CRM 细胞（cell-crm）

| 配置项 | 说明 | 默认/示例 |
|--------|------|-----------|
| server.port | 监听端口 | Java 8083；本仓库 cells 端口见 deploy |
| spring.profiles.active | 持久化方式 | 默认内存；jpa 使用 H2 |
| spring.datasource.url（jpa） | 数据源 | jdbc:h2:mem:cell_crm |

**扩展点**：同用户细胞；金额字段可接 SensitiveEncryptor 或脱敏策略。

---

## 4.1 其余业务细胞（cell-erp、cell-oa、cell-srm 等）

端口与路由以 **《架构实现对照表》第三节** 及网关路由配置为准；各细胞配置见对应模块。细胞档案见 **docs/细胞档案/**。

---

## 5. 公共（platform-common / 本仓库平台能力）

| 扩展点 | 说明 |
|--------|------|
| EventPublisher | 生产环境替换为 Kafka/RocketMQ 实现，发布 PlatformEvent |
| SensitiveEncryptor | 密钥从配置中心/KMS 注入；可增加国密 SM4 实现 |
| TraceIdFilter / TraceIdGlobalFilter | 已透传 X-Request-ID、X-Tenant-Id；可增加采样、限流等 |

---

## 6. 请求头约定

| 头 | 说明 | 必填 |
|----|------|------|
| X-Request-ID | 全链路追踪 ID | 可选，网关/细胞可自动生成 |
| X-Tenant-Id | 租户标识 | 多租户场景必填 |

---

*与《详细设计实现说明》同步更新。*
