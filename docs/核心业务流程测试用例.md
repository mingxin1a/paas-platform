# 核心业务流程测试用例

**版本**：1.0  
**执行脚本**：`deploy/core_business_flow_tests.py`（可直接执行）

---

## 1. 使用说明

| 场景 | 命令 |
|------|------|
| 经网关全量流程 | `GATEWAY_URL=http://localhost:8000 python deploy/core_business_flow_tests.py` |
| 仅健康检查 | `python deploy/core_business_flow_tests.py --health-only` |
| 指定 Cell | `python deploy/core_business_flow_tests.py --cell crm` |
| 简单压测（约 1 分钟） | `python deploy/core_business_flow_tests.py --load` |

**前置条件**：网关与待测 Cell 已启动（如 `deploy/deploy.sh` 或 docker compose up）。

---

## 2. 覆盖的商用核心流程

| Cell | 测试用例 | 说明 |
|------|----------|------|
| 网关 | 网关 /health | 网关可用 |
| 各 Cell | /health | 各细胞健康 |
| CRM | 客户创建 + 客户列表 | 客户→商机→合同→回款 首环节 |
| ERP | 物料创建 + 采购订单创建 | 采购流程：物料→PO→（应付/付款） |
| WMS | 库存列表 + 入库 | 入库→库存→出库 |
| MES | 工单列表 + BOM 列表 | 计划→工单→领料→报工→入库 查询 |
| OA | 审批列表 | 审批流程 |
| SRM | 供应商列表 | 供应商→RFQ |
| TMS | 运单列表 | 运单管理 |
| EMS | 能耗采集 + 按日统计 | 采集→统计→预警→报表 |
| PLM | 产品创建 + BOM 列表 | 产品→BOM 版本→变更→文档 |
| HIS | 患者列表 | 患者→挂号→就诊→处方→收费 |
| LIS | 样本列表 | 检验申请→样本→结果→报告 |
| LIMS | 样品列表 + 留存配置 | 样品→任务→数据→报告→溯源 |
| 通用 | 幂等性 | EMS 能耗采集同一 X-Request-ID 二次请求 |
| 通用 | 故障隔离 | 网关健康汇总可访问 |

---

## 3. 断言与通过标准

- 网关 /health 返回 200。
- 各 Cell /health 返回 200 且 `status=up`。
- 各业务接口按上表返回 200/201，且关键字段存在（如 customerId、materialId）。
- 幂等：同一 X-Request-ID 二次 POST 返回 200/201（同资源）或 409。
- 压测（--load）：成功率≥99%（脚本内为示例 1 分钟、50 并发）。

---

## 4. 与《超级PaaS平台商用验收测试报告》对应关系

- **功能完整性验证**：本脚本覆盖「对每个 Cell 的核心商用流程进行端到端测试」。
- **可靠性验证**：幂等用例对应「重复提交核心接口无重复数据」；故障隔离为「健康汇总可访问」，人工停 Cell 后可由健康汇总观察。
- **性能验证**：`--load` 为简易压测，完整 100 并发 5 分钟需在环境就绪后执行并核对响应时间≤500ms、无报错。
