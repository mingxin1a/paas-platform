详细设计说明书 V2.0
1. 引言
1.1 编写目的
本文档详细描述了超级PaaS平台的系统设计细节，为开发团队提供具体的技术实现指导，确保系统具备高可用性、易用性和安全性。
1.2 项目范围
本说明书涵盖平台的用户交互、安全风控、数据处理等核心模块的详细设计。
2. 总体设计
2.1 系统架构
系统采用分层架构设计，包括感知交互层、应用开发层、平台服务层等。
2.2 技术栈
•前端：React + TypeScript + Ant Design
•后端：Spring Boot + Java 17
•数据库：MySQL 8.0 + Redis 7.0
•消息队列：RocketMQ 5.0
3. 模块详细设计
3.1 用户交互与体验模块
3.1.1 极简操作流
设计原则：
•3-Click Rule：任何核心业务操作必须在3次鼠标点击内完成
•懒加载策略：采用无限滚动或虚拟列表技术
•意图预判：AI根据用户行为预测下一步操作
具体实现：
// 操作路径优化
class OperationOptimizer {
// 检查操作路径深度
checkPathDepth(path: string[]): boolean {
return path.length <= 3;
}
// 意图识别
predictIntent(userBehavior: UserBehavior): Intent {
// AI算法预测用户意图
return this.aiService.predict(userBehavior);
}
}
3.1.2 视觉与无障碍设计
设计规范：
•字体：HarmonyOS Sans无衬线字体
•颜色对比度：文本与背景对比度>4.5:1（WCAG 2.1 AA标准）
•键盘导航：支持Tab键顺序导航，Enter键确认，ESC键关闭
实现方案：
/* 无障碍样式 */
.accessible-button {
font-family: 'HarmonyOS Sans', sans-serif;
color: #333;
background: #fff;
outline: 2px solid transparent;
outline-offset: 2px;
}
/* 高对比度模式 */
.high-contrast {
filter: invert(1) hue-rotate(180deg);
}
3.2 安全与风控模块
3.2.1 魔法盾安全机制
功能设计：
1.异地登录拦截
1.1.检测登录IP跨省/跨国
1.2.强制二次验证（短信/人脸）
2.设备指纹识别
2.1.记录用户常用设备信息
2.2.陌生设备进入受限沙箱模式
技术实现：
@Service
public class SecurityShieldService {
// 设备指纹验证
public boolean validateDeviceFingerprint(String userId, String deviceInfo) {
DeviceFingerprint stored = fingerprintRepository.findByUserId(userId);
if (stored == null) {
return true; // 首次设备
}
return calculateSimilarity(stored.getHash(), hashDevice(deviceInfo)) > 0.8;
}
// 异地登录检测
public boolean detectAbnormalLogin(String userId, String ip) {
LoginLocation lastLocation = locationRepository.findLastByUserId(userId);
if (lastLocation == null) return false;
return !isSameRegion(lastLocation.getRegion(), ipToRegion(ip));
}
}
3.2.2 操作反馈设计
交互规范：
•成功：绿色Toast提示 + 动效
•警告：黄色Modal弹窗 + 停顿（必须用户点击才继续）
•危险：红色按钮必须有二次确认气泡，确认按钮文字为"我确认要删除"
// 操作反馈服务
class FeedbackService {
success(message: string) {
notification.success({
message,
icon: <CheckCircleOutlined style={{ color: '#52c41a' }} />
});
}
warning(message: string, onConfirm: () => void) {
Modal.warning({
title: '警告',
content: message,
onOk: onConfirm
});
}
danger(message: string, onConfirm: () => void) {
Modal.confirm({
title: '危险操作',
content: message,
okText: '我确认要删除',
okType: 'danger',
onOk: onConfirm
});
}
}
3.3 数据库设计
3.3.1 安全扩展表
新增表结构：
1.`user_device_fingerprint` - 用户设备指纹表
CREATE TABLE user_device_fingerprint (
id BIGINT PRIMARY KEY COMMENT '主键ID',
user_id BIGINT NOT NULL COMMENT '用户ID',
device_hash VARCHAR(64) NOT NULL COMMENT '设备指纹Hash',
ip_address VARCHAR(45) COMMENT 'IP地址',
region VARCHAR(50) COMMENT '地区',
last_login_time DATETIME COMMENT '最后登录时间',
is_trusted BOOLEAN DEFAULT FALSE COMMENT '是否可信设备',
created_time DATETIME DEFAULT CURRENT_TIMESTAMP,
updated_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
INDEX idx_user_id (user_id),
INDEX idx_device_hash (device_hash)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户设备指纹表';
1.`security_audit_log` - 安全审计日志表
CREATE TABLE security_audit_log (
id BIGINT PRIMARY KEY,
user_id BIGINT NOT NULL,
operation_type VARCHAR(20) NOT NULL,
operation_desc TEXT,
ip_address VARCHAR(45),
device_info TEXT,
result VARCHAR(20),
trace_id VARCHAR(64),
created_time DATETIME DEFAULT CURRENT_TIMESTAMP,
INDEX idx_user_id_time (user_id, created_time),
INDEX idx_trace_id (trace_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='安全审计日志表';
4. 接口设计
4.1 安全相关接口
4.1.1 设备指纹验证接口
接口路径： `POST /api/v1/security/verify-fingerprint`
请求参数：
{
"userId": 123,
"deviceInfo": "browser:chrome;os:windows;screen:1920x1080"
}
响应参数：
{
"code": 200,
"data": {
"isTrusted": true,
"need2FA": false,
"sessionId": "session_abc123"
}
}
4.1.2 一键求救接口
接口路径： `POST /api/v1/security/panic-button`
请求参数：
{
"userId": 123,
"reason": "账号异常"
}
处理逻辑：
1.强制踢出用户所有其他会话
2.冻结资金/核心数据流出
3.锁定当前屏幕并报警
4.记录安全审计日志
5. 部署设计
5.1 离线优先策略
实现方案：
•前端：使用LocalStorage/IndexedDB进行本地缓存
•数据同步：网络恢复后自动进行冲突合并
•冲突解决：采用时间戳优先策略
// 离线数据同步服务
class OfflineSyncService {
private pendingOperations: Operation[] = [];
// 检测网络状态
checkNetworkStatus() {
return navigator.onLine;
}
// 保存离线操作
saveOfflineOperation(operation: Operation) {
this.pendingOperations.push(operation);
localStorage.setItem('pending_ops', JSON.stringify(this.pendingOperations));
}
// 同步离线数据
async syncOfflineData() {
if (!this.checkNetworkStatus()) return;
const operations = JSON.parse(localStorage.getItem('pending_ops') || '[]');
for (const op of operations) {
try {
await this.executeOperation(op);
// 移除已成功操作
this.pendingOperations = this.pendingOperations.filter(o => o.id !== op.id);
} catch (error) {
console.error('Sync failed:', error);
}
}
localStorage.setItem('pending_ops', JSON.stringify(this.pendingOperations));
}
}
6. 测试设计
6.1 测试用例
6.1.1 安全性测试
1.设备指纹识别测试
1.1.验证正常设备登录
1.2.验证陌生设备登录
1.3.验证设备指纹变更
2.一键求救功能测试
2.1.验证强制踢出功能
2.2.验证数据冻结功能
2.3.验证日志记录功能
6.1.2 易用性测试
1.3-Click Rule验证
2.无障碍功能测试
3.暗色模式切换测试
7. 性能设计
7.1 响应时间要求
•页面加载：≤2秒（95%请求）
•接口响应：≤500ms（95%请求）
•搜索响应：≤1秒（95%请求）
7.2 并发能力
•支持10,000+并发用户
•支持每秒1,000+请求处理
8. 附录
8.1 设计规范参考
•WCAG 2.1 AA无障碍标准
•ISO/IEC 27001信息安全标准
•GDPR隐私保护规范
8.2 术语表
•魔法盾：平台安全防护体系
•感知交互：用户可感知的交互体验
•细胞化架构：微服务的进化架构模式