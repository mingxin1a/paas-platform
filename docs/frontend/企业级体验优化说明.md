# 企业级用户体验优化说明

## 一、全局优化

- **懒加载**：除 Layout 外，所有页面组件均通过 `React.lazy` 按需加载，首屏仅加载当前路由，缩短首屏时间。
- **列表缓存**：`useListCache`（`src/hooks/useListCache.ts`）对列表接口结果按 `cellId + path + page + pageSize` 缓存 60 秒，列表页快速切回时优先读缓存，减少重复请求。
- **加载态**：路由级 `Suspense` 使用统一 `PageFallback`（旋转 +「加载中…」），并设置 `role="status"`、`aria-live="polite"` 便于读屏。

## 二、操作优化

- **快捷搜索**：列表页顶部「快捷搜索当前页」输入框，对当前页数据做客户端关键字过滤（任意字段包含即命中）。
- **高级筛选**：可选「筛选字段」+「筛选值」，对当前页按指定字段过滤。
- **表格列自定义**：「列设置」弹出当前表头字段勾选，可见列持久化到 `localStorage`（按 cellId），下次进入自动恢复。
- **批量选择**：表头全选 + 行勾选，顶部展示「已选 N 条」与「取消选择」；为后续批量导出/批量操作预留。
- **导出 / 打印**：导出 CSV 成功后通过 Toast 提示；新增「打印」按钮，打印时通过内联样式隐藏导航、工具栏、分页，仅保留表格内容。
- **行内编辑**：当前列表为只读展示；行内编辑需后端 PATCH 接口支持，可在后续按细胞扩展。

## 三、流程与反馈优化

- **Toast 反馈**：`ToastContext` 提供 `success` / `error` / `info` / `warning`，新建成功、导出成功/失败、提交失败等均通过 Toast 提示，并支持关闭与自动消失。
- **操作指引**：概览页展示可关闭的「操作指引」条，引导用户在「个人设置」中自定义首页与快捷入口，关闭状态持久化到 `localStorage`。
- **异常与空态**：列表请求失败展示错误条（`role="alert"`）；无数据与「当前筛选无结果」区分展示；表单校验失败在字段旁与 Toast 中提示。

## 四、个性化优化

- **个人设置页**（`/settings`）：自定义首页（概览或任一细胞）、主题（浅色/深色/跟随系统）、快捷入口（路径 + 名称，最多 8 个），均持久化到 `localStorage`（`superpaas_preferences`）。
- **自定义首页**：进入「/」时若已设置首页且非「/」，自动重定向到该路径（如 `/cell/crm`）。
- **菜单排序**：`PreferencesContext.menuOrder` 存侧栏细胞顺序，侧栏渲染时按该顺序排列，未配置则使用默认顺序。
- **主题**：设置页与顶栏主题按钮均可切换；`resolvedTheme` 为实际生效主题（system 时根据 `prefers-color-scheme` 计算）。
- **快捷入口**：设置至少一个快捷入口后，顶栏显示「快捷」按钮，点击展开菜单跳转对应路径。

## 五、响应式优化

- **断点**：沿用 `Layout.module.css` 中 768px 侧栏展开/收起；`index.css` 中 1200px 使用 `container-wide` 限制主内容最大宽度（1400px）；1400px 以上主区 padding 略增。
- **打印**：列表页打印时通过媒体查询与类隐藏顶栏、侧栏、返回/导出/列设置/分页等，仅保留表格，适配打印与 PDF。

## 六、无障碍优化

- **跳过链接**：首屏提供「跳到主内容」链接（`.skip-link`），获得焦点时移入视口，便于键盘用户跳过导航。
- **主内容**：`<main id="main-content" role="main" tabIndex={-1}>`，便于跳过链接与读屏定位。
- **焦点**：`*:focus-visible` 统一 2px 主题色描边；按钮、链接均保留可见焦点样式。
- **语义与 ARIA**：列表表头 `scope="col"`；Toast 区域 `role="region" aria-label="通知消息"`，单条 `role="alert"`；错误区 `role="alert"`；加载态 `role="status" aria-live="polite"`；列设置/快捷入口使用 `aria-expanded`、`aria-haspopup`。
- **动画**：`prefers-reduced-motion: reduce` 时关闭动画与过渡，符合无障碍规范。

## 七、流程可视化组件

- **FlowSteps**（`src/components/FlowSteps.tsx`）：横向/纵向步骤条，支持 `pending` / `current` / `done` 与可选时间，可用于审批流、单据流转等展示，按需在详情页或审批页引用。

## 八、使用说明

- 首次使用可在概览页根据「操作指引」进入 **个人设置** 配置首页与快捷入口。
- 列表页使用「快捷搜索」「筛选」「列设置」优化查看；导出后留意 Toast 成功/失败提示；需要纸质或 PDF 时使用「打印」。
- 键盘用户可先 Tab 到「跳到主内容」再进入主区域；读屏用户可依赖当前 ARIA 与语义结构。
- 大屏下主内容区有最大宽度与居中，侧栏在 768px 以上常驻，避免内容过宽与操作不便。
