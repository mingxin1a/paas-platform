# 数据可视化与报表体系说明

## 1. 全平台经营分析首页大屏

- **路由**: `/analytics`
- **能力**: 展示核心经营指标（销售额、采购额、库存周转率、审批效率、生产完成率），支持按日/周/月/季/年切换周期。
- **数据权限**: 仅请求当前用户有权限的汇总数据，由网关按 `X-Tenant-Id`、`Authorization` 过滤。
- **钻取**: 点击 KPI 卡片可下钻至对应模块报表（如销售额/采购额/库存 → ERP 报表，生产完成率 → MES 报表）。

## 2. 业务模块专属报表

| 模块 | 路由 | 报表内容 |
|------|------|----------|
| CRM | `/reports/crm` | 销售漏斗、客户分析 |
| ERP | `/reports/erp` | 采购趋势、销售趋势、库存分析 |
| MES | `/reports/mes` | 生产进度、产能分析 |

- **权限**: 仅对拥有该 Cell 权限的用户开放；无权限时提示并隐藏入口。
- **筛选**: 日期范围、同比/环比对比。
- **导出**: 支持导出 Excel（CSV）、PDF（打印当前页）。

## 3. 自定义报表引擎

- **路由**: `/reports/custom`
- **能力**:
  - 数据源：按权限选择「全平台」或指定 Cell。
  - 维度：时间、部门、区域、产品、客户等。
  - 指标：金额、数量、笔数、占比等。
  - 图表类型：柱状图、饼图。
  - 保存：配置保存到本地，可再次加载。
  - 导出：Excel/PDF。
  - 定时推送：预留入口，需对接后端任务配置。
- **权限**: 仅能选择当前用户有权限的 Cell 与数据。

## 4. 可视化大屏模板

- **经营决策大屏**: `/bigscreen/decision` — 核心经营 KPI 大屏展示。
- **生产车间监控大屏**: `/bigscreen/production` — 工单进度、产能利用率。
- **物流调度大屏**: `/bigscreen/logistics` — 在途运单、准时率。

- **权限**: 大屏数据仅展示用户有权限的模块与租户数据。

## 5. 通用能力

- **多维度筛选**: 各报表页提供日期范围、同比/环比（ReportFilters）。
- **数据钻取**: 经营分析首页 KPI 卡片可下钻至模块报表。
- **导出**: 所有报表支持「导出 Excel」「导出 PDF」（ExportBar）；Excel 为 CSV，PDF 为浏览器打印。
- **数据权限**: 所有报表接口经网关转发，后端按租户与用户权限过滤，前端仅展示有权限的入口与数据。

## 6. 后端对接说明

- **经营 KPI**: `GET /api/analytics/kpi?period=month&startDate=&endDate=`，返回 `AnalyticsKPI`。
- **模块报表**: `GET /api/v1/{cellId}/reports/{reportType}?startDate=&endDate=`，返回 `ReportData`（series/rows）。
- **自定义报表**: `POST /api/analytics/custom`，body 为 `{ cellId, dimensions, metrics, startDate, endDate, compare }`，返回 `ReportData`。

若接口 404，前端使用占位数据以保证页面可演示；正式环境需由后端实现上述接口并严格按权限过滤。
