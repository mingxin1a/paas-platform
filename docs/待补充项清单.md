# SuperPaaS 项目待补充项清单

**编制目的**：基于项目全量目录、文档与代码扫描，按顶层架构设计梳理所有待完善内容，便于排期与跟踪。  
**依据**：《01_核心法律》《接口设计说明书》《数据库设计说明书》《项目合规校验报告》《细胞模块接入校验报告》《架构实现对照表》、glass_house 与代码扫描。  
**更新**：随项目进展增删；建议与 glass_house 周期日志联动更新。

---

## 一、分类与使用说明

| 分类 | 说明 |
|------|------|
| **PaaS 核心层** | 网关、认证、治理、注册、监控、事件总线等平台能力 |
| **业务细胞层** | 各细胞接口合规、鉴权、错误格式、敏感数据、事件发布/订阅 |
| **文档体系** | 宪法/设计说明书、细胞档案、架构选型与合规文档 |
| **部署运维** | 一键部署、告警、验签、安全组件、脚本与 Runbook |
| **测试验证** | 架构解耦校验、接口测试、冒烟、自检与 E2E |

每项标注：**优先级**、**完成标准**、**预计工作量**、**依赖项**。  
**验证架构解耦性的核心待办**在 §七 单独列出并给出落地顺序。

---

## 二、PaaS 核心层

| 序号 | 待办项 | 优先级 | 完成标准 | 预计工作量 | 依赖项 |
|------|--------|--------|----------|------------|--------|
| P1 | **网关细胞名录与显示名配置化** | P0 | 网关细胞列表来自 `load_routes()` 的 keys 或 GATEWAY_ROUTES_PATH 指定文件；显示名来自同文件 `name` 或环境变量 `CELL_DISPLAY_NAMES`；删除硬编码 `_CELL_NAMES`；`admin_cells_patch` 仅校验 cell 是否在路由/注册表中存在 | 1～2 人日 | 无 |
| P2 | **网关用户与细胞权限配置化** | P0 | `_MOCK_USERS` 及 `allowedCells` 改为配置文件或环境变量注入；或由认证服务（auth_center/外部）返回用户可访问细胞列表，网关仅透传与校验 | 1～2 人日 | 可选：认证服务接口约定 |
| P3 | **演示页 demo_cells.html 细胞列表动态化** | P1 | 演示页通过 `/api/admin/cells` 获取细胞列表渲染，或服务端注入从 `load_routes()` 得到的 cell id 列表，删除硬编码 `CELLS` 数组 | 0.5 人日 | P1 |
| P4 | **认证能力扩展** | P1 | 当前网关 Mock 登录已满足演示；生产需对接真实认证（auth_center 或 OAuth2/OIDC）；文档明确「鉴权由网关完成时细胞可信任网关转发」 | 2～5 人日 | 认证服务或 IDP 可用 |
| P5 | **事件总线对接** | P2 | 平台侧提供事件发布/订阅能力（如 Kafka/RabbitMQ）；网关或独立组件支持按《接口设计说明书》3.2 事件结构投递；细胞仅通过 HTTP 或 SDK 发布/消费 | 5～10 人日 | 消息中间件选型与部署 |
| P6 | **数据中台/事件溯源（平台侧）** | P2 | 按《数据库设计说明书》事件存储与读模型在平台层落地（非细胞内）；细胞发布领域事件由平台汇聚 | 大项，单独规划 | P5、业务需求 |
| P7 | **技术栈宪法（Java 平台核心）** | 可选/长期 | 01 1.1 要求 Java 17+ Spring Boot 3；1.1.1 允许 PaaS 核心用其他 LTS（当前 Python）。若需完全符合 01 1.1 无例外，可单独立项 `platform-core-java` 重写网关/注册/监控 | 大项，单独立项 | 无 |

---

## 三、业务细胞层

| 序号 | 待办项 | 优先级 | 完成标准 | 预计工作量 | 依赖项 |
|------|--------|--------|----------|------------|--------|
| C1 | **Flask 细胞鉴权能力** | P1 | 方案 A：在文档中明确「鉴权由网关统一完成」，细胞信任网关转发，无需改代码。方案 B：各 Flask 细胞在 `before_request` 中校验 `Authorization` 存在且以 `Bearer ` 开头，否则返回 401，body 含 code/message/details/requestId | A：文档 0.5 人日；B：约 1 人日/细胞 × 12 | 无 |
| C2 | **Flask 细胞错误响应统一 details** | P1 | 所有 4xx/5xx 响应体均包含 `details` 字段（可为空字符串），与《接口设计说明书》3.1.3 一致 | 约 0.5 人日（批量替换/封装） | 无 |
| C3 | **Flask 细胞 POST/PATCH 强制 X-Request-ID** | P1 | 在 POST/PATCH 入口校验 `X-Request-ID` 存在且非空，否则返回 400，body 为 BAD_REQUEST +「POST/PATCH 必须包含 X-Request-ID」 | 约 0.5 人日（公共 before_request 或装饰器） | 无 |
| C4 | **敏感数据加密与脱敏实施** | P0/高 | 各细胞按《敏感数据加密与脱敏规范》落实：敏感列 AES-256/SM4 加密、KMS 密钥、界面与日志动态脱敏；可先在 CRM 试点 | 2～5 人日/细胞（视字段数量） | 规范文档、可选 KMS |
| C5 | **前端感知安全（安全态势、动态水印、审计入口）** | 高 | 登录/敏感操作时展示安全态势区域；列表/详情页动态水印（用户名+时间）；主导航「谁在何时访问了我的数据」对接 GET /api/admin/audit 或占位数据并展示 | 2～3 人日 | 可选：审计 API |
| C6 | **细胞事件发布/订阅** | P2 | 细胞按《接口设计说明书》3.2 发布 crm.* / erp.* 等事件；订阅他细胞事件时仅异步消费，禁止同步强一致 | 1～2 人日/细胞（含契约文档） | P5 事件总线 |
| C7 | **HRM 血肉化** | P2 | HRM 扩展业务逻辑与数据模型，达到 production_ready；补齐细胞档案 | 按产品需求 | 无 |

---

## 四、文档体系

| 序号 | 待办项 | 优先级 | 完成标准 | 预计工作量 | 依赖项 |
|------|--------|--------|----------|------------|--------|
| D1 | **架构选型记录** | P1 | 在架构文档或《技术栈与01宪法对照说明》中明确记录：平台核心采用 Python 的理由、与 01 1.1 技术栈的差异及 1.1.1 例外条款引用 | 0.5 人日 | 无 |
| D2 | **细胞档案标准化** | P1 | 其余 12 个细胞档案按《细胞档案》模板（参考 docs/细胞档案/CRM_细胞档案.md）补齐：模块身份卡、细胞膜 API 清单、细胞核 ER/库设计、接入校验清单、部署运维 | 约 1 人日/细胞（可分批） | 无 |
| D3 | **网关/路由与 API 契约同步说明** | P2 | 文档明确：新增细胞时需维护 gateway_route_spec 或 CELL_*_URL、docker-compose、前端配置（若仍保留前端细胞配置）；或提供「按 cells 目录/manifest 生成配置」的脚本说明 | 0.5 人日 | 无 |
| D4 | **待补充项与合规报告联动** | P2 | 本清单与《项目合规校验报告》《细胞模块接入校验报告》中「已补充」状态、P0/P1 修改建议保持一致；重大变更时同步更新 | 持续 | 无 |

---

## 五、部署运维

| 序号 | 待办项 | 优先级 | 完成标准 | 预计工作量 | 依赖项 |
|------|--------|--------|----------|------------|--------|
| O1 | **告警与安全审计联动** | P1 | 按《部署与运维规范》在日志采集/APM 侧配置：验签失败、红绿灯拒绝、熔断打开等规则，并对接告警通道（邮件/钉钉/短信） | 1～2 人日（依赖运维环境） | 日志/APM 就绪 |
| O2 | **生产环境签名/验签强制** | P1 | 生产部署时强制配置 GATEWAY_SIGNING_SECRET、CELL_VERIFY_SIGNATURE=1、CELL_SIGNING_SECRET；文档与 .env.example 已体现（见《部署与运维规范》） | 文档已就绪；部署检查清单 0.5 人日 | 无 |
| O3 | **新增细胞部署脚本/文档** | P2 | 提供脚本或 Runbook：根据 cells 目录或 manifest 批量生成 docker-compose 片段、gateway_route_spec 条目，使新增细胞时仅需加配置或跑脚本 | 1～2 人日 | 无 |
| O4 | **魔法盾 / 蜜罐 / 一键求救** | P2 | 01 4.2 魔法盾（异地登录、设备指纹、蜜罐）、01 4.3 一键求救（踢出会话、冻结、锁屏、告警）在平台或前端落地；可先做占位与接口设计 | 5～10 人日 | 安全与产品需求 |

---

## 六、测试验证

| 序号 | 待办项 | 优先级 | 完成标准 | 预计工作量 | 依赖项 |
|------|--------|--------|----------|------------|--------|
| T1 | **架构解耦：细胞不依赖 platform_core** | P0 | 已实现：`tests/test_architecture_decoupling.py` 中 `test_cells_do_not_import_platform_core` 通过；保持细胞零 import platform_core | 0（已满足） | 无 |
| T2 | **架构解耦：网关细胞名录配置化后测试收紧** | P0 | 完成 P1（网关细胞名录配置化）后，将 `test_gateway_cell_list_not_hardcoded` 的 skip 改为断言失败：若仍存在硬编码 _CELL_NAMES 则测试不通过 | 0.5 人日 | P1 |
| T3 | **冒烟测试路径动态化** | P1 | `deploy/smoke_test.py` 从网关 `/api/admin/cells` 或各细胞 completion.manifest/api_contract 解析待测路径，删除硬编码 `CELL_PATHS` | 1 人日 | P1 或细胞 manifest 约定 |
| T4 | **全细胞健康测试路径动态化** | P1 | `tests/test_all_cells_health.py` 从各细胞 api_contract.yaml 或 completion.manifest 解析主列表路径（如首个 list GET），删除硬编码 `CELL_MAIN_GET` | 1 人日 | 细胞 manifest 约定 |
| T5 | **前端细胞列表从 API 获取** | P1 | `frontend/src/config/cells.ts` 基础细胞列表从 `/api/admin/cells` 获取；前端仅保留展示增强（如 labelMap）或由细胞自描述提供 | 1～2 人日 | P1 |
| T6 | **细胞接口合规自动化** | P2 | 将《细胞模块接入校验报告》中的检查项（鉴权、错误格式、X-Request-ID、X-Response-Time）纳入 verify_delivery 或单独脚本，PR 时可自动跑 | 1～2 人日 | C1～C3 规范统一 |

---

## 七、验证架构解耦性的核心待办与落地顺序

以下项直接验证或巩固「地基与房子」解耦、乐高原则、平台无业务状态；建议按序落地。

| 顺序 | 待办编号 | 简述 | 验证目标 |
|------|----------|------|----------|
| 1 | **P1** | 网关细胞名录与显示名配置化 | 平台不硬编码「有哪些细胞」，新增细胞仅改配置/路由，不改平台代码 |
| 2 | **P2** | 网关用户与细胞权限配置化 | 平台不硬编码「谁可访问哪些细胞」，权限由配置或认证服务提供 |
| 3 | **T2** | 网关细胞名录配置化后测试收紧 | 防止回溯：硬编码一旦出现，测试失败 |
| 4 | **P3** | 演示页细胞列表动态化 | 单一事实来源：细胞列表来自网关 API |
| 5 | **T3、T4** | 冒烟与健康测试路径动态化 | 测试与部署不维护细胞路径表，来自配置或细胞自描述 |
| 6 | **T5** | 前端细胞列表从 API 获取 | 前端不硬编码细胞 id/name/path，支持热插拔展示 |
| 7 | **O3** | 新增细胞部署脚本/文档 | 新增细胞时一键或少量配置即可接入，无需手改多文件 |

**说明**：  
- **P1、P2** 为《项目合规校验报告》P0 项，完成后平台与细胞名录/权限解耦即达标。  
- **T1** 已通过（细胞无 platform_core 依赖），保持即可。  
- **C1～C3** 为细胞侧接口合规，与「平台是否硬编码」解耦独立，可与 P1/P2 并行推进。

---

## 八、汇总表（按优先级）

| 优先级 | 序号 | 分类 | 简述 |
|--------|------|------|------|
| **P0** | P1, P2 | PaaS 核心层 | 网关细胞名录与用户权限配置化 |
| **P0** | T1 | 测试验证 | 细胞不依赖 platform_core（已满足） |
| **P0/高** | C4 | 业务细胞层 | 敏感数据加密与脱敏实施 |
| **高** | C5 | 业务细胞层 | 前端感知安全（态势、水印、审计入口） |
| **P1** | P3, P4 | PaaS 核心层 | 演示页动态化；认证能力扩展 |
| **P1** | C1, C2, C3 | 业务细胞层 | Flask 细胞鉴权、错误 details、强制 X-Request-ID |
| **P1** | D1, D2 | 文档体系 | 架构选型记录；细胞档案标准化 |
| **P1** | O1, O2 | 部署运维 | 告警联动；生产验签强制 |
| **P1** | T2, T3, T4, T5 | 测试验证 | 名录配置化后测试收紧；冒烟/健康/前端路径动态化 |
| **P2** | P5, P6 | PaaS 核心层 | 事件总线；数据中台/事件溯源 |
| **P2** | C6, C7 | 业务细胞层 | 细胞事件发布/订阅；HRM 血肉化 |
| **P2** | D3, D4 | 文档体系 | 路由与契约同步说明；与合规报告联动 |
| **P2** | O3, O4 | 部署运维 | 新增细胞脚本；魔法盾/蜜罐/一键求救 |
| **P2** | T6 | 测试验证 | 细胞接口合规自动化 |
| **可选** | P7 | PaaS 核心层 | 技术栈宪法（Java 重写平台核心，见 01 1.1） |

---

## 九、已补充项（历史记录，便于对照）

| 原序号/项 | 状态 | 说明 |
|-----------|------|------|
| 原 §二 项 4、6 | 已完成 | 9 细胞已具备 src/app.py、Dockerfile、docker-compose、verify_delivery 通过 |
| 原 §二 项 7 | 已完成 | deploy/docker-compose 已含 13 细胞、治理、监控、双前端；gateway_route_spec 已全量 |
| 原 §三 项 8、9 | 已落档 | scripts/weekly_benchmark_scan.sh、glass_house/runbook_*.md；自愈 Runbook 已补充 |
| 原 §四 项 12、13 | 已落档 | 《部署与运维规范》告警联动、签名/验签强制策略 |
| 原 §五 项 15 | 已就绪 | 网关路由由 CELL_*_URL 或 GATEWAY_ROUTES_PATH 加载，新增细胞需加环境变量或路由文件 |

---

**文档状态**：基于全量目录与文档扫描整理；P0/P1 与《项目合规校验报告》《细胞模块接入校验报告》一致。  
**维护**：建议在 glass_house 周期日志或本清单中更新完成项及完成时间；重大架构变更时同步修订 §七 落地顺序。
