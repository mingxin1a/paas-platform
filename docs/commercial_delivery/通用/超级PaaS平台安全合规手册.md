# 超级PaaS平台安全合规手册

**版本**：1.0  
**适用对象**：企业 IT 管理员、安全与合规人员  
**目标**：数据安全、权限安全、合规要求、审计流程，满足商用与行业合规。

---

## 一、数据安全

### 1.1 传输安全

| 要求 | 说明 |
|------|------|
| HTTPS | 生产环境必须在网关前配置 TLS（如 Nginx/负载均衡终结 HTTPS），避免明文传输。 |
| 请求头 | 敏感信息不通过 URL 传递；认证信息放在 Authorization 头。 |

### 1.2 存储与展示

| 要求 | 说明 |
|------|------|
| 敏感字段加密 | 手机号、身份证号、金额等可按企业策略采用 AES 或国密算法存储；密钥由 KMS 或环境变量管理，见《敏感数据加密与脱敏规范》。 |
| 脱敏展示 | 接口返回与日志中，对敏感字段脱敏（如手机号中间四位 *、身份证前4后2），避免明文泄露。 |
| 多租户隔离 | 数据按租户隔离，见《多租户配置指南》；禁止跨租户查询与越权访问。 |

### 1.3 备份与恢复

- 备份脚本与备份文件需限制访问权限；恢复操作需授权并留痕。
- 含敏感数据的备份建议加密存储。

---

## 二、权限安全

| 层级 | 说明 |
|------|------|
| 认证 | 登录校验用户名与密码（或对接统一认证）；发放 Token，过期与刷新策略需配置。 |
| 授权 | 网关与细胞根据用户角色与 allowedCells 控制可访问的细胞与接口；细胞内可根据 X-User-Id 做数据级权限（仅看本人负责数据）。 |
| 最小权限 | 生产账号按角色分配最小必要权限；避免长期使用超级管理员账号处理日常操作。 |

---

## 三、合规要求

| 类型 | 说明 |
|------|------|
| 接口规范 | 遵循《接口设计说明书》：统一错误体、请求头、幂等、追踪 ID；OpenAPI 文档完整。 |
| 操作审计 | 关键操作（登录、数据变更、配置变更）记录审计日志；日志内容人类可读，含操作人、时间、操作类型、结果；日志不可篡改（只追加或写入专用存储）。 |
| 行业合规 | 医疗细胞（HIS/LIS）需符合医疗数据隐私与脱敏要求；工业细胞（MES/WMS/EMS）需满足数据留存与上报要求；详见各细胞《行业合规指南》。 |

---

## 四、审计流程

```mermaid
flowchart LR
  A[操作发生] --> B[记录审计日志]
  B --> C[写入日志存储]
  C --> D[可检索/导出]
  D --> E[合规检查/事故追溯]
```

| 步骤 | 说明 |
|------|------|
| 记录 | 各细胞与网关在关键操作时调用审计接口或写审计表/日志，包含：租户、用户、时间、操作类型、资源、结果、trace_id。 |
| 存储 | 审计日志单独存储或单独索引，与业务数据分离；保留周期按企业或行业要求（如 ≥1 年）。 |
| 检索与导出 | 支持按时间、用户、操作类型、租户等条件检索；合规检查或事故调查时可导出审计报告。 |

---

## 五、安全配置检查清单

| 序号 | 检查项 | 说明 |
|------|--------|------|
| 1 | 生产启用 HTTPS | 网关前配置 TLS，禁用 HTTP（或仅限内网）。 |
| 2 | 强制租户 ID | 生产设置 GATEWAY_REQUIRE_TENANT_ID=1。 |
| 3 | 密钥与配置 | 数据库密码、API 密钥等不写死在代码中，使用环境变量或密钥服务。 |
| 4 | 敏感数据脱敏 | 确认 CRM/HIS/TMS 等细胞接口与日志中敏感字段已脱敏。 |
| 5 | 审计日志 | 确认关键操作已落审计日志，且保留策略符合要求。 |
| 6 | 依赖与漏洞 | 定期更新依赖，修复已知漏洞；镜像与基础镜像定期打补丁。 |

---

**文档归属**：商用交付文档包 · 通用  
**维护**：随安全与合规要求更新。
