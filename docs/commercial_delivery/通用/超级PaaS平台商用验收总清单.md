# 超级PaaS平台商用验收总清单

**版本**：2.0  
**用途**：全项目商用验收的完整检查表，按平台、业务模块、部署运维、安全合规、文档体系分类；支持必填/选填与自动化验收脚本对照。  
**使用**：验收人在「验收结果」列填写 通过/不通过/不适用；自动化验收由 `scripts/run_acceptance_test.py` 执行并生成报告。

---

## 一、PaaS 平台

| 序号 | 验收项 | 验收标准 | 验收方法 | 必填/选填 | 验收结果 |
|------|--------|----------|----------|-----------|----------|
| P1 | 网关健康 | GET /health 返回 200，body 含 status | 自动化：请求 /health 断言 200 | 必填 | |
| P2 | 认证登录 | POST /api/auth/login 正确账号密码返回 token 与 user | 自动化：登录接口断言 200 与 token | 必填 | |
| P3 | 认证校验 | 无 token 访问 /api/v1/* 返回 400/401 | 自动化：缺 Authorization 请求断言 4xx | 必填 | |
| P4 | 管理端越权防护 | 非 admin 角色访问 /api/admin/* 返回 403 | 自动化：client token 访问 admin 接口断言 403 | 必填 | |
| P5 | 细胞代理路由 | 已配置细胞经 /api/v1/<cell>/<path> 可转发并返回 2xx/4xx | 自动化：各细胞 /health 或主列表 GET | 必填 | |
| P6 | 请求头规范 | POST/PUT 缺 X-Request-ID 或 Content-Type 返回 400 | 手工/自动化：缺头请求断言 400 | 选填 | |
| P7 | 多租户头 | 生产可配置 GATEWAY_REQUIRE_TENANT_ID=1，缺 X-Tenant-Id 返回 400 | 配置检查+请求断言 | 选填 | |
| P8 | 熔断与限流 | 网关集成熔断/限流，异常或超限返回 503/429 | 文档与配置检查 | 选填 | |

---

## 二、业务模块（按 Cell）

每个业务 Cell 至少满足：健康可探测、主列表可访问、核心写操作可调用（若该 Cell 支持）。

| 序号 | 验收项 | 验收标准 | 验收方法 | 必填/选填 | CRM | ERP | OA | SRM | MES | WMS | TMS | 其他 |
|------|--------|----------|----------|-----------|-----|-----|-----|-----|-----|-----|-----|------|
| C1 | 健康检查 | GET /api/v1/<cell>/health 返回 200，status=up | 自动化：test_cell_health(cell) | 必填 | | | | | | | | |
| C2 | 主列表 GET | 主列表接口 GET 返回 200，含 data/total 或等价 | 自动化：主列表路径 GET | 必填 | | | | | | | | |
| C3 | 核心写流程 | 至少一条核心创建/更新流程可跑通（如 CRM 创建客户） | 自动化：对应 flow 测试 | 必填 | | | | | | | | |
| C4 | 租户隔离 | 请求带 X-Tenant-Id，数据按租户隔离 | 自动化：多租户请求或文档检查 | 必填 | | | | | | | | |
| C5 | 导出/报表 | 该 Cell 若有导出或报表接口，返回 200 且格式正确 | 自动化或手工 | 选填 | | | | | | | | |
| C6 | 人性化报错 | 必填项为空或非法时返回 4xx 且 message 可读 | 手工或自动化 | 选填 | | | | | | | | |

**分模块验收**：仅验收某一 Cell 时，执行 `python scripts/run_acceptance_test.py --module <cell_id>`，只跑该 Cell 相关项。

---

## 三、部署运维

| 序号 | 验收项 | 验收标准 | 验收方法 | 必填/选填 | 验收结果 |
|------|--------|----------|----------|-----------|----------|
| D1 | 网关可启动 | 执行 run_gateway.py 或等价方式，网关监听 8000 | 实际启动+curl /health | 必填 | |
| D2 | 细胞可独立部署 | 各 Cell 可独立进程/容器启动，不依赖其他 Cell | 部署文档+实际部署 | 必填 | |
| D3 | 路由配置 | 网关路由可通过环境变量或配置文件指定 | 检查 GATEWAY_ROUTES_PATH / CELL_*_URL | 必填 | |
| D4 | Docker 部署 | 提供 Dockerfile 或 docker-compose，可一键构建/启动 | 文档与文件存在性检查 | 选填 | |
| D5 | K8s 部署 | 提供 K8s 清单或 Helm，可部署到集群 | 文档与文件存在性检查 | 选填 | |
| D6 | 监控与告警 | 集成 Prometheus/Grafana 或等价，有告警规则 | 文档与配置检查 | 选填 | |
| D7 | 备份与恢复 | 有数据备份/恢复脚本或说明 | 文档检查 | 选填 | |
| D8 | 日志标准化 | 日志分级、可检索、含 trace_id | 文档与样例检查 | 选填 | |

---

## 四、安全合规

| 序号 | 验收项 | 验收标准 | 验收方法 | 必填/选填 | 验收结果 |
|------|--------|----------|----------|-----------|----------|
| S1 | 生产禁用 Mock 认证 | 生产环境 GATEWAY_USE_MOCK_AUTH=0，对接认证中心 | 配置与环境检查 | 必填 | |
| S2 | 安全响应头 | 响应含 X-Content-Type-Options、X-Frame-Options 等 | 自动化：检查响应头 | 必填 | |
| S3 | 登录限流 | 登录接口按 IP 限流，防暴力破解 | 配置与文档检查 | 必填 | |
| S4 | 多租户数据隔离 | PaaS 与 Cell 按租户隔离，无越权 | 自动化与文档 | 必填 | |
| S5 | 操作审计 | 关键操作有审计日志，含 trace_id/用户/时间 | 文档与存储检查 | 必填 | |
| S6 | 敏感数据脱敏 | 敏感字段加密或脱敏展示，不落明文 | 文档与实现检查 | 选填 | |
| S7 | HTTPS | 生产环境 HTTPS | 部署检查 | 选填 | |
| S8 | 依赖与代码扫描 | CI 集成 Bandit/Safety，无高危未修复 | 检查 CI 与报告 | 选填 | |

---

## 五、文档体系

| 序号 | 验收项 | 验收标准 | 验收方法 | 必填/选填 | 验收结果 |
|------|--------|----------|----------|-----------|----------|
| DOC1 | 总交付手册 | 存在商用交付总手册，含部署与验收说明 | 文件存在性+目录检查 | 必填 | |
| DOC2 | 接口规范 | 遵循《接口设计说明书》，关键接口有文档 | 文档存在性 | 必填 | |
| DOC3 | 部署运维手册 | 存在部署、运维、监控、备份说明 | 文档存在性 | 必填 | |
| DOC4 | 用户/管理员手册 | 至少核心 Cell 有用户或管理员手册 | 文档存在性 | 必填 | |
| DOC5 | 安全与合规文档 | 存在安全合规说明、渗透测试或加固文档 | 文档存在性 | 必填 | |
| DOC6 | 验收清单 | 存在本验收总清单及自动化验收说明 | 文件存在性 | 必填 | |
| DOC7 | 细胞交付手册 | 各 Cell 具备部署/使用/故障处理文档 | 按 Cell 检查 | 选填 | |

---

## 六、验收结果汇总

| 分类 | 必填项总数 | 通过数 | 选填项总数 | 通过数 | 备注 |
|------|------------|--------|------------|--------|------|
| PaaS 平台 | 5 | | 3 | | |
| 业务模块 | 按 Cell 计 | | | | |
| 部署运维 | 3 | | 5 | | |
| 安全合规 | 5 | | 3 | | |
| 文档体系 | 6 | | 1 | | |

**验收结论**：必填项全部通过方可视为商用验收通过；选填项作为加分或后续迭代项。

---

**签字与日期**：验收人 ____________  日期 ____________  

---

## 七、自动化验收说明

| 用途 | 命令 | 输出 |
|------|------|------|
| **最终验收（推荐）** | `python scripts/run_final_acceptance.py` | `dist/最终验收报告.md`（含文档生成、pytest 自检、覆盖率、商用验收） |
| 全量验收 | `python scripts/run_acceptance_test.py` | `dist/acceptance_report_YYYYMMDD_HHMM.md` |
| 分模块验收 | `python scripts/run_module_acceptance.py <cell_id>` | 同上（仅执行该 Cell 相关项） |
| 仅健康检查 | `python scripts/run_acceptance_test.py --health-only` | 同上（仅各细胞 /health） |
| 补齐缺失文档 | `python scripts/generate_docs.py` | 自动生成缺失的用户手册、管理员手册、接口文档 |

环境变量 `GATEWAY_URL` 可指定网关地址（默认 `http://localhost:8000`）。无网关时可执行 `run_final_acceptance.py --skip-gateway` 仅跑自检与覆盖率。报告可附于本清单后。
