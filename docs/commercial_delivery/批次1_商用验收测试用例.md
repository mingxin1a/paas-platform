# 批次1 商用验收测试用例

**版本**：1.0  
**适用范围**：CRM、ERP、OA、SRM 四模块功能、导出、行级权限、人性化报错、压测达标

---

## 一、CRM

| 用例编号 | 用例名称 | 前置条件 | 步骤 | 预期结果 | 结果 |
|----------|----------|----------|------|----------|------|
| CRM-01 | 销售预测接口 | 租户下存在商机 | GET /reports/sales-forecast，头 X-Tenant-Id | 200，body 含 byStage、totalWeightedCents | |
| CRM-02 | 客户列表行级权限 | 头 X-Data-Scope: self，X-User-Id: u1 | 创建客户时带 u1，再 GET /customers 带上述头 | 仅返回 ownerId=u1 的客户 | |
| CRM-03 | 客户导出 CSV | 租户下有客户 | GET /export/customers?format=csv | 200，Content-Type text/csv，含表头与数据行 | |
| CRM-04 | 人性化报错-客户名空 | - | POST /customers body {} | 400，message 为「请填写客户名称」类描述 | |
| CRM-05 | 商机创建归属人 | 头 X-User-Id: u1 | POST /opportunities 创建商机 | 201，返回 opportunityId，列表中 ownerId=u1（当 data_scope=self） | |

---

## 二、ERP

| 用例编号 | 用例名称 | 前置条件 | 步骤 | 预期结果 | 结果 |
|----------|----------|----------|------|----------|------|
| ERP-01 | 生产成本核算汇总 | 存在工单且已报工（含单位材料/人工成本） | GET /pp/cost-summary | 200，data 含 materialCostCents、laborCostCents、totalCostCents | |
| ERP-02 | 单工单成本明细 | 存在已报工工单 | GET /pp/work-orders/{id}/cost | 200，含 materialCostCents、laborCostCents、totalCostCents | |
| ERP-03 | 工单报工带成本 | 存在工单 | POST /pp/work-orders/{id}/report body completedQuantity, unitMaterialCostCents, unitLaborCostCents | 200，工单可汇总到 cost-summary | |
| ERP-04 | 销售订单导出 CSV | 租户下有订单 | GET /export/orders?format=csv | 200，text/csv，含订单ID/客户ID/金额等列 | |
| ERP-05 | 人性化报错-工单不存在 | - | GET /pp/work-orders/nonexistent-id/cost | 404，message 为「工单不存在或尚未报工」类描述 | |

---

## 三、OA

| 用例编号 | 用例名称 | 前置条件 | 步骤 | 预期结果 | 结果 |
|----------|----------|----------|------|----------|------|
| OA-01 | 电子签章 | 存在审批单（draft 或 pending） | POST /approvals/{instanceId}/seal，头 X-User-Id | 200，body 含 sealedAt、sealedBy | |
| OA-02 | 审批单打印模板 | 存在审批单 | GET /approvals/{instanceId}/print | 200，Content-Type text/html，页面含审批单号、类型、签章状态 | |
| OA-03 | 审批列表分页 | - | GET /approvals?page=1&pageSize=20 | 200，data、total、page、pageSize | |
| OA-04 | 人性化报错-标题必填 | - | POST /announcements body {} | 400，details 含「请填写公告标题」类描述 | |

---

## 四、SRM

| 用例编号 | 用例名称 | 前置条件 | 步骤 | 预期结果 | 结果 |
|----------|----------|----------|------|----------|------|
| SRM-01 | 招投标项目创建 | - | POST /bidding/projects body {title:"项目A"} | 201，projectId、status=open | |
| SRM-02 | 招投标项目列表与详情 | 存在招投标项目 | GET /bidding/projects；GET /bidding/projects/{id} | 200，列表含 data/total；详情含 title、rfqIds | |
| SRM-03 | 招投标项目状态更新 | 存在项目 | PATCH /bidding/projects/{id} body {status:"closed"} | 200，status=closed | |
| SRM-04 | 采购订单导出 CSV | 租户下有采购订单 | GET /export/purchase-orders?format=csv | 200，text/csv，含订单编号、供应商ID、金额等 | |
| SRM-05 | 人性化报错-项目名空 | - | POST /bidding/projects body {} | 400，message「请填写项目名称」、details 说明 | |

---

## 五、性能验收（JMeter）

| 项 | 标准 | 结果 |
|----|------|------|
| 核心 GET 接口单接口 TPS | ≥500 | |
| 核心 GET 接口 P95 响应时间 | ≤300ms | |
| 健康检查 P95 | ≤50ms | |
| 错误率 | 0% | |

执行方式见《批次1_JMeter压测说明.md》。

---

## 六、单元/集成测试覆盖率

| 细胞 | 覆盖率目标 | 实际 | 结果 |
|------|------------|------|------|
| CRM | ≥85% | | |
| ERP | ≥85% | | |
| OA | ≥85% | | |
| SRM | ≥85% | | |

执行：各细胞目录下 `pytest tests/ --cov=src --cov-report=term-missing`。

---

**签字**：验收人 ____________  日期 ____________  
**文档归属**：商用交付文档包 · 批次1
