# CRM 管理员手册

**版本**：1.0  
**细胞名称**：客户关系管理（CRM）  
**适用对象**：系统管理员、实施人员

---

## 一、权限配置

| 层级 | 说明 |
|------|------|
| 网关/平台 | 在管理端或认证系统中，为用户分配可访问的细胞列表（allowedCells）；拥有 CRM 权限的用户才能访问 `/api/v1/crm/*`。 |
| 数据级 | CRM 通过请求头 `X-User-Id` 识别当前用户；列表与详情接口仅返回该用户作为「负责人」的客户（或按角色放宽）。管理员需在业务侧保证客户与负责人的绑定正确（创建客户时指定负责人）。 |

当前版本中，负责人（owner_id）在创建客户时由请求体或当前用户带入；若需在管理端批量分配负责人，可依赖平台侧用户管理或后续扩展的「客户分配」接口。

---

## 二、流程与配置

| 项目 | 说明 |
|------|------|
| 商机阶段 | 商机阶段（如需求确认、方案报价、谈判、赢单/输单）由系统预置或配置；若细胞支持阶段配置表，可在数据或配置中心维护。 |
| 审批流程 | 合同审批等若需与 OA 联动，通过流程配置在 OA 中定义，CRM 侧仅提交审批单；具体见 OA 细胞《管理员手册》。 |

---

## 三、系统参数配置

| 参数 | 说明 | 示例 |
|------|------|------|
| PORT | 服务监听端口 | 8001 |
| DEFAULT_TENANT_ID | 未传租户时默认租户（仅开发/测试建议使用） | default |
| CELL_VERIFY_SIGNATURE | 是否启用网关验签 | 0 或 1 |
| 数据库连接 | 生产切换 MySQL 时配置连接串 | 见 cells/crm 配置说明 |

---

## 四、故障处理

| 现象 | 可能原因 | 处理 |
|------|----------|------|
| /health 失败 | 进程未启动或依赖（如 DB）不可用 | 检查容器/进程与日志；重启服务；检查数据库连接。 |
| 列表为空 | 租户错误或数据级权限导致无数据 | 确认请求头 X-Tenant-Id、X-User-Id 与业务数据一致。 |
| 导入失败 | 文件格式或必填项错误 | 查看接口返回的错误信息；按模板修正后重试。 |
| 重复数据 | 未使用幂等键 | 导入或创建时携带 X-Request-ID，避免重复提交。 |

---

## 五、数据维护

- **备份**：定期备份 CRM 数据库（SQLite 文件或 MySQL dump），见《超级PaaS平台商用交付总手册》备份流程。
- **归档**：可根据企业策略对历史客户/商机做归档或冷存储，保证在线查询性能。

---

**文档归属**：商用交付文档包 · 细胞 · CRM
