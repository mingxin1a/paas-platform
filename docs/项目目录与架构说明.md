# 项目目录与架构说明

**文档性质**：项目结构导航与架构总览  
**关联**：[超级PaaS平台逻辑全景图](超级PaaS平台逻辑全景图.md)、[docs/README](README.md)

---

## 1. 顶层目录一览

| 目录/文件 | 用途 |
|-----------|------|
| **cells/** | 业务细胞（独立模块）：CRM、ERP、WMS、HRM、OA、MES、TMS、SRM、PLM、EMS、HIS、LIS、LIMS。每个细胞独立代码、契约、交付包。 |
| **platform_core/** | 平台核心：网关、路由、熔断、注册/健康、监控、签名等。 |
| **frontend/** | 客户端前端（业务端），端口 5173，登录后按 `allowedCells` 使用细胞。 |
| **frontend-admin/** | 管理端前端，端口 5174，登录后做细胞启用/停用、用户与权限、审计占位。 |
| **deploy/** | 部署与运行脚本：网关启动、部署逻辑、监控中心、冒烟测试。 |
| **evolution_engine/** | 自主进化引擎：感知→对标→进化→验证→透明化；单次周期 `evolution_engine.py`，全细胞交付校验 `verify_all_cells.py`。 |
| **glass_house/** | 玻璃房透明化：ADR、演化日志、gap 分析、孵化器清单、人工介入队列、runbook。 |
| **docs/** | 神圣文档与设计说明书、细胞档案、合规与运维规范。 |
| **scripts/** | 通用脚本：自检 `self_check.sh`/`self_check.py`、单细胞校验 `verify_delivery.sh`、进化周期 `run_evolution_cycle.sh`、全量验证 `run_full_verification.py`、周基准扫描等。 |
| **tests/** | 平台级测试：全细胞健康、网关 demo、E2E（含 CRM 集成、熔断、自愈）。 |
| **README.md** | 项目简介与快速入口。 |
| **run.sh** | 统一入口：`self_check` / `verify <CELL>` / `evolution` / `full_verify`。 |

---

## 2. 目录树（关键节点，已省略 node_modules / dist / __pycache__）

```
pass-platform/
├── cells/                    # 业务细胞
│   ├── crm/ erp/ wms/ hrm/ oa/ mes/ tms/ srm/ plm/ ems/ his/ lis/ lims/
│   │   ├── src/              # 细胞源码：app.py, store.py, signing_verify.py
│   │   ├── api_contract.yaml
│   │   ├── delivery.package  # 交付包描述
│   │   ├── completion.manifest
│   │   ├── ai_agent.py, auto_healing.yaml
│   │   ├── README.md, cell_profile.md
│   │   └── (部分细胞) tests/, docs/
│   └── requirements.txt
├── platform_core/
│   └── core/
│       ├── gateway/          # 网关：app.py, config, circuit_breaker, signing, traffic_light
│       ├── registry/         # 注册与健康：client, health
│       ├── monitor/          # 监控与黄金指标：client, golden_metrics
│       └── cell_signing.py
├── frontend/                 # 客户端 (Vite + React)，端口 5173
├── frontend-admin/          # 管理端 (Vite + React)，端口 5174
├── deploy/                   # run_gateway.py, deploy.py, monitor_center.py, smoke_test.py
├── evolution_engine/         # evolution_engine.py, verify_delivery.py, verify_all_cells.py
├── glass_house/             # 透明化：ADR、gap_analysis/、live_evolution_log、runbook 等
├── docs/                     # 文档与细胞档案
├── scripts/                  # self_check.*, verify_delivery.sh, run_evolution_cycle.sh, run_full_verification.py 等
├── tests/                    # test_all_cells_health, test_gateway_demo, e2e/
├── README.md
├── run.sh                    # 统一入口：self_check | verify <CELL> | evolution | full_verify
└── .gitignore
```

---

## 3. 请求流与入口

### 3.1 请求流

- **客户端**：用户打开 `frontend`（5173）→ 登录 `/api/auth/login`（网关）→ 获取 token 与 `allowedCells` → 业务请求走 `/api/v1/<cell>/<path>`，由网关代理到对应细胞。
- **管理端**：用户打开 `frontend-admin`（5174）→ 登录同上 → 管理请求走 `/api/admin/cells`（GET/PATCH）等，由网关处理。
- **网关**：统一入口（默认 8000），提供登录、admin 细胞列表/启用停用、健康检查、demo 页、可选静态托管；对 `/api/v1/<cell>/...` 按路由表代理到细胞并做熔断、追踪、签名校验。

### 3.2 认证与权限

- 网关内 Mock 用户：`admin/admin`、`client/123`、`operator/123`；返回 JWT 与 `user.role`、`user.allowedCells`。
- 前端将 token 存 localStorage，请求头带 `Authorization: Bearer <token>`。
- 客户端仅展示并访问 `allowedCells` 内细胞；管理端侧重 admin 能力（细胞管理、用户/权限占位）。

### 3.3 关键入口汇总

| 用途 | 入口 |
|------|------|
| 启动网关 | `deploy/run_gateway.py` 或按部署文档 |
| 启动客户端 | `frontend/` 下 `npm run dev`（5173） |
| 启动管理端 | `frontend-admin/` 下 `npm run dev`（5174） |
| 启动单个细胞 | 各细胞 `cells/<name>/` 内运行其 `src/app.py`（见细胞 README） |
| 全细胞交付校验 | `python evolution_engine/verify_all_cells.py` |
| 单细胞交付校验 | `./run.sh verify <cell_name>` 或 `./scripts/verify_delivery.sh <cell_name>` 或 `python evolution_engine/verify_delivery.py <cell_name>` |
| 进化周期（单次） | `./run.sh evolution` 或 `./scripts/run_evolution_cycle.sh` 或 `python evolution_engine/evolution_engine.py` |
| 全量验证（脚本） | `./run.sh full_verify` 或 `python scripts/run_full_verification.py` |
| 自检 | `./run.sh self_check` 或 `python scripts/self_check.py` |
| 平台测试 | `pytest tests/`（如 test_all_cells_health、test_gateway_demo、e2e） |

---

## 4. 与逻辑全景图的关系

- **战略层 / 平台层 / 应用层** 见 [超级PaaS平台逻辑全景图](超级PaaS平台逻辑全景图.md)。
- **平台层** 对应本仓库中的 `platform_core/`、网关与注册/监控；**应用层** 对应 `cells/`；**感知交互层** 对应 `frontend/`、`frontend-admin/` 与网关的 Web/API 入口。
- 文档索引与层级映射见 [docs/README](README.md) 与逻辑全景图 §6、§8。

---

## 5. 维护与扩展

- **新增细胞**：在 `cells/` 下新建目录，满足 `api_contract.yaml`、`delivery.package` 及平台契约；在网关路由/注册中登记。
- **变更平台能力**：修改 `platform_core/` 或网关配置，遵循 [glass_house/architecture_decisions.md](../glass_house/architecture_decisions.md)。
- **文档**：设计说明书、合规、细胞档案统一放在 `docs/`，以逻辑全景图为导航。
