# 管理端与客户端说明

平台拆分为**管理端**与**客户端**，符合现代应用逻辑：管理端管理整个平台，客户端使用各细胞业务。

---

## 1. 双端划分

| 端 | 目录 | 端口(dev) | 职责 |
|----|------|-----------|------|
| **管理端** | frontend-admin/ | 5174 | 登录、概览、细胞管理（启用/停用）、用户与权限、审计日志 |
| **客户端** | frontend/ | 5173 | 登录、按权限使用细胞（列表/详情）、数据访问记录、主题切换 |

---

## 2. 登录与认证

- **登录接口**：网关提供 `POST /api/auth/login`，body `{ username, password }`，返回 `{ token, user: { username, role, allowedCells } }`。
- **演示账号**（当前为网关内 Mock）：
  - **管理端**：`admin` / `admin`（角色 admin，可访问管理端全部功能）。
  - **客户端**：`client` / `123`（角色 client，allowedCells: crm, erp, wms, hrm, oa）；`operator` / `123`（allowedCells: crm, wms, oa）。
- 前端将 token 与 user 存入 localStorage，请求网关时带 `Authorization: Bearer <token>`。

---

## 3. 权限划分

- **角色**：`admin`（管理员）、`client`（客户端用户）。
- **管理端**：仅管理员登录后使用；负责细胞启用/停用、用户与权限查看（占位）、审计占位。
- **客户端**：管理员可见全部细胞；客户端用户仅可见且仅可访问其 `allowedCells` 中的细胞；直接访问无权限细胞时提示「无权限」并返回概览。

---

## 4. 细胞管理（管理端）

- **GET /api/admin/cells**：列表细胞及启用状态、Base URL（需 Authorization）。
- **PATCH /api/admin/cells/:id**：body `{ enabled: true|false }`，启用或停用细胞（当前为网关内存状态，重启后恢复默认）。
- 管理端「细胞管理」页展示表格，支持按细胞启用/停用。

---

## 5. 运行方式

1. **启动网关**（必须）：  
   `python -m platform_core.core.gateway.app`  
   默认端口 8000。

2. **启动客户端**：  
   `cd frontend && npm run dev`  
   访问 http://localhost:5173 ，使用 client/123 或 operator/123 登录后使用细胞。

3. **启动管理端**：  
   `cd frontend-admin && npm install && npm run dev`  
   访问 http://localhost:5174 ，使用 admin/admin 登录后管理细胞与查看权限/审计。

---

## 6. 后续对接建议

- **登录**：将 Mock 用户改为对接统一认证（如 OAuth2/OIDC 或自建用户中心），网关 `/api/auth/login` 改为转发或校验后签发 JWT。
- **权限**：用户与权限表、角色与 allowedCells 持久化，管理端「用户与权限」页对接后端 CRUD。
- **细胞启用**：将 `PATCH /api/admin/cells/:id` 的 enabled 状态持久化到配置或数据库，网关启动时加载。
- **审计**：管理端/客户端「审计」页对接按 trace_id 的访问日志 API。

---

**文档状态**：与当前双端实现及网关 API 一致。
