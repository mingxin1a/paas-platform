# 灾备站点 K8s 部署示例（与主站同构，副本数可先设为 1，切换后扩容）
# 用法: 在灾备集群 apply 前修改 namespace/image/副本数，并确保从 S3 恢复数据后挂载或导入
---
apiVersion: v1
kind: Namespace
metadata:
  name: paas-dr
  labels:
    app.kubernetes.io/name: superpaas
    dr-site: standby
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: gateway
  namespace: paas-dr
spec:
  replicas: 1
  selector:
    matchLabels:
      app: gateway
  template:
    metadata:
      labels:
        app: gateway
    spec:
      containers:
        - name: gateway
          image: superpaas/gateway:latest
          ports:
            - containerPort: 8000
          env:
            - name: DR_SITE_ID
              value: "dr"
          livenessProbe:
            httpGet:
              path: /health
              port: 8000
            initialDelaySeconds: 10
            periodSeconds: 5
---
apiVersion: v1
kind: Service
metadata:
  name: gateway
  namespace: paas-dr
spec:
  selector:
    app: gateway
  ports:
    - port: 8000
      targetPort: 8000
  type: ClusterIP
